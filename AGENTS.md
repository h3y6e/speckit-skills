# AGENTS.md

## Project Overview

speckit-skills transforms GitHub's [spec-kit](https://github.com/github/spec-kit) SDD workflow into the portable [Agent Skills](https://agentskills.io) format (9 skills).
The only application code is `mise-tasks/generate.py`. The `skills/` directory is **generated output** -- never edit files there by hand.

## Tech Stack

- **Language**: Python 3.14+
- **Package manager**: [uv](https://docs.astral.sh/uv/) (managed via mise)
- **Task runner**: [mise](https://mise.jdx.dev/) (inline tasks in `mise.toml`, file tasks in `mise-tasks/`)
- **Dependencies**: `pyyaml`, `specify-cli` (from spec-kit)
- **Dev tools**: `ruff` (linter/formatter), `basedpyright` (type checker)

## Build / Lint / Test Commands

### Setup

```sh
mise install        # Install uv and Python toolchain
uv sync             # Install Python deps (mise does this automatically via prepare)
```

### Build

```sh
mise run generate   # Run specify init, copy/patch skills, verify output
```

### Linting & Type Checking

```sh
mise run lint           # ruff check
mise run lint:fix       # ruff check --fix
mise run format         # ruff format
mise run format:check   # ruff format --check
mise run typecheck      # basedpyright
mise run check          # lint + format:check + typecheck
mise run check:fix      # lint:fix + format + typecheck
```

## Project Structure

```
mise-tasks/generate.py      # Main (and only) application code
skills/                     # GENERATED OUTPUT -- do not edit manually
  speckit-*/
    SKILL.md                # Skill definition (YAML frontmatter + markdown)
    scripts/                # Bash helper scripts
    references/             # Markdown templates
docs/plan/                  # Design docs
.agents/skills/             # Intermediate generated files (gitignored)
.specify/                   # spec-kit generated files (gitignored)
.codex/                     # Codex prompts generated by spec-kit (gitignored)
```

## Code Style Guidelines

### Imports

- Use `from __future__ import annotations` at the top of every module.
- Group: stdlib, third-party, local. Sorted by ruff (`I` rule).

### Formatting

- `ruff format` (Black-compatible). Line length: 320 chars (`pyproject.toml`).
- Let ruff handle all formatting decisions. Do not manually format code.

### Lint Rules

`select = ["E", "F", "W", "I", "UP"]` -- pycodestyle, pyflakes, isort, pyupgrade.

### Type Annotations

- basedpyright strict mode (`reportExplicitAny = false`, `reportAny = false`).
- Annotate all function signatures.
- Use `type` statement for type aliases (e.g., `type Patches = list[tuple[str, str]]`).

### Naming Conventions

- **Constants**: `UPPER_SNAKE_CASE` (e.g., `ROOT`, `SKILLS`, `COMMON_PATCHES`)
- **Functions / Variables**: `snake_case`
- **Type aliases**: `PascalCase` (e.g., `Patches`)

### Error Handling

- Fatal errors: `sys.exit(1)` with messages to stderr.
- Warnings: `WARNING:` prefix, continue processing.
- `verify_output()` collects all violations before exiting.

### Patterns

- `pathlib.Path` exclusively (never `os.path`). `shutil` for copy operations.
- Assign unused return values: `_ = path.write_text(content)`.
- `subprocess.run()` with `capture_output=True`, `text=True`. Check `returncode` explicitly.
- Patches as `(old, new)` tuple pairs applied via `str.replace()`.

## Git Conventions

### Commit Messages

[Conventional Commits](https://www.conventionalcommits.org/) with sentence case:
`feat:`, `fix:`, `chore:`, `docs:` (e.g., `feat: Add generated skills`).

### What to Commit

- `skills/` (generated output) **is committed**.
- `.agents/skills/speckit-*`, `.specify/`, `.codex/`, `.venv/` are gitignored.
- CI auto-regenerates `skills/` when upstream `specify-cli` is updated.

## Architecture Notes

### Patch System

`generate.py` uses a declarative patch system with `(old, new)` replacement pairs:

- `SKILL_PATCHES`: skill-specific, keyed by skill name and relative file path.
- `COMMON_PATCHES`: applied to all files after skill-specific patches.
- `FORBIDDEN_PATTERNS`: regex patterns verified absent from all output.

### Adding a New Skill

1. Add the skill name and resources to `SKILLS` dict in `generate.py`.
2. Add skill-specific patches to `SKILL_PATCHES`.
3. Run `mise run generate` and verify output.
